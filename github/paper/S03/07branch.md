# Git 分支操作

各位小伙伴大家好，咱们接着前面的课程，继续讲解 Github 开源之旅第三季：Git 进阶。现在咱们讲解本课程的最后一个话题，也是最重要的一个话题：Git 分支操作。如果使用 Git 而没有掌握 Git 分支操作，我们说这个人使用 Git 的水平还是幼儿园阶段。当然，我们都是从幼儿园过来的，也没有什么好丢人的，大家小时候都穿过开裆裤，没错吧。

这里，我们提一下 Git 的分支。首先，我们前面讲过 Git 存储方式，Git 存储的是快照，而不是版本差异，这就导致 Git 在分支操作上，开销非常低，效率非常高，分支合并的速度非常快。所以，不使用 Git 分支操作，Git 的强大之处，等于没有发挥出来。但是，这貌似不是使用 Git 分支的一个不可辩驳的理由。其实，使用 Git 分支有一个真正不可抗拒的理由，那就是并行开发。在软件开发和项目管理中，为了让项目的工期尽可能短，一般会采用的方式就是并行开发。最常见的并行开发的场景就是，开发和测试的并行。如果版本控制系统不支持分支操作，那么所有的工作就只能串行，这样就非常不方便了。分支操作一般是配合项目的流程控制来灵活使用或规范使用的。而项目的流程控制，我们会在 Github 开源之旅第四季课程中展开讲解，这里面我们只是提一下。我们先给小伙伴们看一个大型项目的 Gitflow 工作流。

![](https://docs.gitlab.com/ee/workflow/gitdashflow.png)  

这里面，关于分支我们分一下类，大致分两类：长期分支和临时分支。以上图为例，长期分支是 master 和 develop，而功能分支、发布分支和缺陷修复分支都是临时分支。临时分支是，需要的时候开一个分支，分支上工作完成后，跟主干分支合并，合并之后，临时分支被删除，所以是临时分支。有了这些分支，项目团队中的开发工作就可以并行开展了，比如当前的开发，不用因为缺陷修复或者版本发布而停滞不前，新功能的开发可以继续进行，因为新功能的开发是在功能分支上独立进行的，功能开发完成后才会合并到开发分支上。而缺陷修复也不会让新功能的开发处于暂停等待状态。因为，缺陷修复也是在独立的分支中开展的。这个流程图是最复杂的一种情况，如果我们能把这个协作流程图搞明白，那么分支的操作自然不在话下，而且，我们后续的课程也很容易就能学会。所以，这个图大家一定要花些时间搞明白。当然，凡事都要一分为二的来看，Git 分支的灵活和方便，必然会导致分支的滥用，如下图所示。已经分不清楚哪个是主干分支了，所以，这里面需要对 Git 团队协作的流程进行规范和约定，具体内容咱们在下一门课程中展开讲解。

![](http://image.beekka.com/blog/201207/bg2012070502.png)  

知道了分支的用途和意义之后，咱们把重点放在学习 Git 的分支操作相关的命令。只有掌握了这些命令的使用，我们才能随心所欲的使用分支，灵活高效的使用分支。我们特别强调一下，Git 本身就支持分支操作，其实 master 本身就是一个分支，只不过我们都把这个分支叫 master，名字固定下来了。


- git 分支基本操作

    ```bash
    # 创建分支 foo
    git branch foo

    # 切换到分支 foo
    git checkout foo

    # 创建分支并同时切换到 foo，一步做到
    git checkout -b foo

    # 修改分支名字
    git branch -m old_name new_name
    git branch -M old_name new_name

    # 删除分支 foo 分支，前提 foo 已经合并过
    git branch foo -d

    # 强制删除分支 foo
    git branch foo -D

    # 列出远程分支
    git branch -r

    # 查看已经合并的分支
    git branch --merged

    # 查看没有合并的分支
    git branch --no-merged

    # 列出远程合并的分支
    git branch -r --merged

    # 取出远程的 foo 分支
    git checkout -t origin/foo

    # 删除远程分支 1
    # <space> 是空格，<remote branch> 是远程分支的名字
    # 把空内容推到远程的分支上，就是删除的意思
    git push origin <space> :<remote branch>

    # 删除远程分支 2
    # 在 github 上可以直接删除分支
    # 在本地 git pull 不能把远程分支的变化反应到本地
    # git pull 和 git fetch 不会清除已经删除的远程分支
    # git branch -r 还可以看到已经删除的远程分支
    # sourceTree 的线图还可以看到已经删除的远程分支
    # 可以执行下面的命令解决问题
    git fetch -p

    # 合并分支
    git merge <branch name>

    # 合并分支，拒绝 fast forward，产生合并 commit
    git merge --no-ff
    ```

- git stash 操作  

    ```bash
    # 保存进度
    git stash

    # 弹出进度
    git stash pop

    # 查看 stash 列表
    git stash list

    # 删除所有进度
    git stash clear
    ```
